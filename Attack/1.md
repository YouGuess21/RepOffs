# Attack 1


One of our employees at the company complained about suspicious behavior on the machine, our IR team took a memory dump from the machine and we need to investigate it.

Q1. What is the best profile for the the machine?

example : crew{Profile}

Link

Author : 0xSh3rl0ck
<hr>

Using volatility 3;
```
youguess@youguess-Inspiron-14-5410-2-in-1:~/CTFs/crewctf/Attack$ sudo python3 ~/volatility3/vol.py -f memdump.raw windows.info
Volatility 3 Framework 2.4.2
Progress:  100.00		PDB scanning finished                        
Variable	Value

Kernel Base	0x82a42000
DTB	0x185000
Symbols	file:///home/youguess/volatility3/volatility3/symbols/windows/ntkrpamp.pdb/E12E472CBDC1417AA1755893ED23A668-2.json.xz
Is64Bit	False
IsPAE	True
layer_name	0 WindowsIntelPAE
memory_layer	1 FileLayer
KdDebuggerDataBlock	0x82b7ab78
NTBuildLab	7601.24214.x86fre.win7sp1_ldr_es    ..............................//here
CSDVersion	1
KdVersionBlock	0x82b7ab50
Major/Minor	15.7601
MachineType	332
KeNumberProcessors	1
SystemTime	2023-02-20 19:10:54
NtSystemRoot	C:\Windows
NtProductType	NtProductWinNt
NtMajorVersion	6
NtMinorVersion	1
PE MajorOperatingSystemVersion	6
PE MinorOperatingSystemVersion	1
PE Machine	332
PE TimeDateStamp	Thu Aug  2 02:12:23 2018
```
Using volatility 2;
```
youguess@youguess-Inspiron-14-5410-2-in-1:~/CTFs/crewctf/Attack$ sudo python2 ~/volatility/vol.py -f memdump.raw imageinfo
INFO    : volatility.debug    : Determining profile based on KDBG search...
          Suggested Profile(s) : Win7SP1x86_23418, Win7SP0x86, Win7SP1x86_24000, Win7SP1x86 ...........//here
                     AS Layer1 : IA32PagedMemoryPae (Kernel AS)
                     AS Layer2 : FileAddressSpace (/home/youguess/CTFs/crewctf/Attack/memdump.raw)
                      PAE type : PAE
                           DTB : 0x185000L
                          KDBG : 0x82b7ab78L
          Number of Processors : 1
     Image Type (Service Pack) : 1
                KPCR for CPU 0 : 0x80b96000L
             KUSER_SHARED_DATA : 0xffdf0000L
           Image date and time : 2023-02-20 19:10:54 UTC+0000
     Image local date and time : 2023-02-20 21:10:54 +0200
```
## Flag: crewCTF{Win7SP1x86_23418}
<hr><hr><hr>

# Attack 2
<hr>
We need to find number of processes. We can use the plugin pslist to see all the process.

```
youguess@youguess-Inspiron-14-5410-2-in-1:~/CTFs/crewctf/Attack$ sudo python2 ~/volatility/vol.py -f memdump.raw --profile=Win7SP1x86_23418 pslist
Offset(V)  Name                    PID   PPID   Thds     Hnds   Sess  Wow64 Start                          Exit                          
---------- -------------------- ------ ------ ------ -------- ------ ------ ------------------------------ ------------------------------
0x8419c020 System                    4      0     89      536 ------      0 2023-02-20 19:01:19 UTC+0000                                 
0x962f2020 smss.exe                268      4      2       29 ------      0 2023-02-20 19:01:19 UTC+0000                                 
0x860a8c78 csrss.exe               352    344      9      462      0      0 2023-02-20 19:01:20 UTC+0000                                 
0x855dfd20 wininit.exe             404    344      3       76      0      0 2023-02-20 19:01:20 UTC+0000                                 
0x8550b030 csrss.exe               416    396      9      268      1      0 2023-02-20 19:01:20 UTC+0000                                 
0x85ea2368 services.exe            480    404      8      220      0      0 2023-02-20 19:01:20 UTC+0000                                 
0x85ea8610 lsass.exe               488    404      6      568      0      0 2023-02-20 19:01:20 UTC+0000                                 
0x85eab718 lsm.exe                 496    404     10      151      0      0 2023-02-20 19:01:20 UTC+0000                                 
0x85eacb80 winlogon.exe            508    396      5      115      1      0 2023-02-20 19:01:20 UTC+0000                                 
0x85f4d030 svchost.exe             632    480     10      357      0      0 2023-02-20 19:01:21 UTC+0000                                 
0x85ef0a90 svchost.exe             700    480      8      280      0      0 2023-02-20 19:01:21 UTC+0000                                 
0x919e2958 svchost.exe             752    480     22      507      0      0 2023-02-20 19:01:21 UTC+0000                                 
0x85f9c3a8 svchost.exe             868    480     13      309      0      0 2023-02-20 19:01:21 UTC+0000                                 
0x85fae030 svchost.exe             908    480     18      715      0      0 2023-02-20 19:01:21 UTC+0000                                 
0x85fb7670 svchost.exe             952    480     34      995      0      0 2023-02-20 19:01:22 UTC+0000                                 
0x85ff1380 svchost.exe            1104    480     18      391      0      0 2023-02-20 19:01:22 UTC+0000                                 
0x8603a030 spoolsv.exe            1236    480     13      270      0      0 2023-02-20 19:01:22 UTC+0000                                 
0x86071818 svchost.exe            1280    480     19      312      0      0 2023-02-20 19:01:22 UTC+0000                                 
0x860b73c8 svchost.exe            1420    480     10      146      0      0 2023-02-20 19:01:22 UTC+0000                                 
0x860ba030 taskhost.exe           1428    480      9      205      1      0 2023-02-20 19:01:22 UTC+0000                                 
0x861321c8 dwm.exe                1576    868      5      114      1      0 2023-02-20 19:01:23 UTC+0000                                 
0x8613c030 explorer.exe           1596   1540     29      842      1      0 2023-02-20 19:01:23 UTC+0000                                 
0x841d7500 VGAuthService.         1636    480      3       84      0      0 2023-02-20 19:01:23 UTC+0000                                 
0x86189d20 vmtoolsd.exe           1736   1596      8      179      1      0 2023-02-20 19:01:23 UTC+0000                                 
0x8619dd20 vm3dservice.ex         1848    480      4       60      0      0 2023-02-20 19:01:24 UTC+0000                                 
0x861a9030 vmtoolsd.exe           1884    480     13      290      0      0 2023-02-20 19:01:24 UTC+0000                                 
0x861b5360 vm3dservice.ex         1908   1848      2       44      1      0 2023-02-20 19:01:24 UTC+0000                                 
0x861fc700 svchost.exe             580    480      6       91      0      0 2023-02-20 19:01:25 UTC+0000                                 
0x86261030 WmiPrvSE.exe           1748    632     10      204      0      0 2023-02-20 19:01:25 UTC+0000                                 
0x86251bf0 dllhost.exe             400    480     15      196      0      0 2023-02-20 19:01:26 UTC+0000                                 
0x8629e518 msdtc.exe              2168    480     14      158      0      0 2023-02-20 19:01:31 UTC+0000                                 
0x8629e188 SearchIndexer.         2276    480     12      581      0      0 2023-02-20 19:01:31 UTC+0000                                 
0x8630b228 wmpnetwk.exe           2404    480      9      212      0      0 2023-02-20 19:01:32 UTC+0000                                 
0x862cca38 svchost.exe            2576    480     15      232      0      0 2023-02-20 19:01:33 UTC+0000                                 
0x85351030 WmiPrvSE.exe           3020    632     11      242      0      0 2023-02-20 19:01:45 UTC+0000                                 
0x853faac8 ProcessHacker.         3236   1596      9      416      1      0 2023-02-20 19:02:37 UTC+0000                                 
0x843068f8 sppsvc.exe             2248    480      4      146      0      0 2023-02-20 19:03:25 UTC+0000                                 
0x85f89640 svchost.exe            2476    480     13      369      0      0 2023-02-20 19:03:25 UTC+0000                                 
0x843658d0 cmd.exe                2112   2876      1       20      1      0 2023-02-20 19:03:40 UTC+0000                                 
0x84368798 cmd.exe                2928   2876      1       20      1      0 2023-02-20 19:03:40 UTC+0000                                 
0x84365c90 conhost.exe            1952    416      2       49      1      0 2023-02-20 19:03:40 UTC+0000                                 
0x84384d20 conhost.exe            2924    416      2       49      1      0 2023-02-20 19:03:40 UTC+0000                                 
0x84398998 runddl32.exe            300   2876     10     2314      1      0 2023-02-20 19:03:40 UTC+0000                                 
0x84390030 notepad.exe            2556    300      2       58      1      0 2023-02-20 19:03:41 UTC+0000                                 
0x84df2458 audiodg.exe            1556    752      6      129      0      0 2023-02-20 19:10:50 UTC+0000                                 
0x84f1caf8 DumpIt.exe             2724   1596      2       38      1      0 2023-02-20 19:10:52 UTC+0000                                 
0x84f3d878 conhost.exe            3664    416      2       51      1      0 2023-02-20 19:10:52 UTC+0000                                 

```
We can also use plugin windows.pslist.PsList in volatility3
```
youguess@youguess-Inspiron-14-5410-2-in-1:~/CTFs/crewctf/Attack$ sudo python3 ~/volatility3/vol.py -f memdump.raw windows.pslist.PsList
Volatility 3 Framework 2.4.2
Progress:  100.00		PDB scanning finished                        
PID	PPID	ImageFileName	Offset(V)	Threads	Handles	SessionId	Wow64	CreateTime	ExitTime	File output

4	0	System	0x8419c020	89	536	N/A	False	2023-02-20 19:01:19.000000 	N/A	Disabled
268	4	smss.exe	0x962f2020	2	29	N/A	False	2023-02-20 19:01:19.000000 	N/A	Disabled
352	344	csrss.exe	0x860a8c78	9	462	0	False	2023-02-20 19:01:20.000000 	N/A	Disabled
404	344	wininit.exe	0x855dfd20	3	76	0	False	2023-02-20 19:01:20.000000 	N/A	Disabled
416	396	csrss.exe	0x8550b030	9	268	1	False	2023-02-20 19:01:20.000000 	N/A	Disabled
480	404	services.exe	0x85ea2368	8	220	0	False	2023-02-20 19:01:20.000000 	N/A	Disabled
488	404	lsass.exe	0x85ea8610	6	568	0	False	2023-02-20 19:01:20.000000 	N/A	Disabled
496	404	lsm.exe	0x85eab718	10	151	0	False	2023-02-20 19:01:20.000000 	N/A	Disabled
508	396	winlogon.exe	0x85eacb80	5	115	1	False	2023-02-20 19:01:20.000000 	N/A	Disabled
632	480	svchost.exe	0x85f4d030	10	357	0	False	2023-02-20 19:01:21.000000 	N/A	Disabled
700	480	svchost.exe	0x85ef0a90	8	280	0	False	2023-02-20 19:01:21.000000 	N/A	Disabled
752	480	svchost.exe	0x919e2958	22	507	0	False	2023-02-20 19:01:21.000000 	N/A	Disabled
868	480	svchost.exe	0x85f9c3a8	13	309	0	False	2023-02-20 19:01:21.000000 	N/A	Disabled
908	480	svchost.exe	0x85fae030	18	715	0	False	2023-02-20 19:01:21.000000 	N/A	Disabled
952	480	svchost.exe	0x85fb7670	34	995	0	False	2023-02-20 19:01:22.000000 	N/A	Disabled
1104	480	svchost.exe	0x85ff1380	18	391	0	False	2023-02-20 19:01:22.000000 	N/A	Disabled
1236	480	spoolsv.exe	0x8603a030	13	270	0	False	2023-02-20 19:01:22.000000 	N/A	Disabled
1280	480	svchost.exe	0x86071818	19	312	0	False	2023-02-20 19:01:22.000000 	N/A	Disabled
1420	480	svchost.exe	0x860b73c8	10	146	0	False	2023-02-20 19:01:22.000000 	N/A	Disabled
1428	480	taskhost.exe	0x860ba030	9	205	1	False	2023-02-20 19:01:22.000000 	N/A	Disabled
1576	868	dwm.exe	0x861321c8	5	114	1	False	2023-02-20 19:01:23.000000 	N/A	Disabled
1596	1540	explorer.exe	0x8613c030	29	842	1	False	2023-02-20 19:01:23.000000 	N/A	Disabled
1636	480	VGAuthService.	0x841d7500	3	84	0	False	2023-02-20 19:01:23.000000 	N/A	Disabled
1736	1596	vmtoolsd.exe	0x86189d20	8	179	1	False	2023-02-20 19:01:23.000000 	N/A	Disabled
1848	480	vm3dservice.ex	0x8619dd20	4	60	0	False	2023-02-20 19:01:24.000000 	N/A	Disabled
1884	480	vmtoolsd.exe	0x861a9030	13	290	0	False	2023-02-20 19:01:24.000000 	N/A	Disabled
1908	1848	vm3dservice.ex	0x861b5360	2	44	1	False	2023-02-20 19:01:24.000000 	N/A	Disabled
580	480	svchost.exe	0x861fc700	6	91	0	False	2023-02-20 19:01:25.000000 	N/A	Disabled
1748	632	WmiPrvSE.exe	0x86261030	10	204	0	False	2023-02-20 19:01:25.000000 	N/A	Disabled
400	480	dllhost.exe	0x86251bf0	15	196	0	False	2023-02-20 19:01:26.000000 	N/A	Disabled
2168	480	msdtc.exe	0x8629e518	14	158	0	False	2023-02-20 19:01:31.000000 	N/A	Disabled
2276	480	SearchIndexer.	0x8629e188	12	581	0	False	2023-02-20 19:01:31.000000 	N/A	Disabled
2404	480	wmpnetwk.exe	0x8630b228	9	212	0	False	2023-02-20 19:01:32.000000 	N/A	Disabled
2576	480	svchost.exe	0x862cca38	15	232	0	False	2023-02-20 19:01:33.000000 	N/A	Disabled
3020	632	WmiPrvSE.exe	0x85351030	11	242	0	False	2023-02-20 19:01:45.000000 	N/A	Disabled
3236	1596	ProcessHacker.	0x853faac8	9	416	1	False	2023-02-20 19:02:37.000000 	N/A	Disabled
2248	480	sppsvc.exe	0x843068f8	4	146	0	False	2023-02-20 19:03:25.000000 	N/A	Disabled
2476	480	svchost.exe	0x85f89640	13	369	0	False	2023-02-20 19:03:25.000000 	N/A	Disabled
2112	2876	cmd.exe	0x843658d0	1	20	1	False	2023-02-20 19:03:40.000000 	N/A	Disabled
2928	2876	cmd.exe	0x84368798	1	20	1	False	2023-02-20 19:03:40.000000 	N/A	Disabled
1952	416	conhost.exe	0x84365c90	2	49	1	False	2023-02-20 19:03:40.000000 	N/A	Disabled
2924	416	conhost.exe	0x84384d20	2	49	1	False	2023-02-20 19:03:40.000000 	N/A	Disabled
300	2876	runddl32.exe	0x84398998	10	2314	1	False	2023-02-20 19:03:40.000000 	N/A	Disabled
2556	300	notepad.exe	0x84390030	2	58	1	False	2023-02-20 19:03:41.000000 	N/A	Disabled
1556	752	audiodg.exe	0x84df2458	6	129	0	False	2023-02-20 19:10:50.000000 	N/A	Disabled
2724	1596	DumpIt.exe	0x84f1caf8	2	38	1	False	2023-02-20 19:10:52.000000 	N/A	Disabled
3664	416	conhost.exe	0x84f3d878	2	51	1	False	2023-02-20 19:10:52.000000 	N/A	Disabled
youguess@youguess-Inspiron-14-5410-2-in-1:~/CTFs/crewctf/Attack$ sudo python3 ~/volatility3/vol.py -f memdump.raw windows.pslist.PsList | wc
     51     580    4205		PDB scanning finished
```
Using wc command after piping we can see its 47 processes (-4 for the header)

## Answer : 47

<hr><hr><hr>

# Attack 3

Q3. i think the user left note on the machine. can you find it ?
<hr>

okay, so as user has stored a note... 
We need to use clipboard plugin .. had to look for it.
```
youguess@youguess-Inspiron-14-5410-2-in-1:~/CTFs/crewctf/Attack$ sudo python2 ~/volatility/vol.py -f memdump.raw --profile=Win7SP1x86_23418 clipboard
Session    WindowStation Format                 Handle Object     Data                                              
---------- ------------- ------------------ ---------- ---------- --------------------------------------------------
         1 WinSta0       CF_UNICODETEXT        0xa00d9 0xfe897838 1_l0v3_M3m0ry_F0r3ns1cs_S0_muchhhhhhhhh           
         1 WinSta0       0x0L                     0x10 ----------                                                   
         1 WinSta0       0x2000L                   0x0 ----------                                                   
         1 WinSta0       0x0L                   0x3000 ----------                                                   
         1 ------------- ------------------   0x1a02a9 0xfe670a68                                                   
         1 ------------- ------------------   0x100067 0xffbab448
```
Either we can do this, 
Or we see that user opens notepad.exe process which we can memdump using 
```
youguess@youguess-Inspiron-14-5410-2-in-1:~/CTFs/crewctf/Attack$ sudo python2 ~/volatility/vol.py -f memdump.raw --profile=Win7SP1x86_23418 memdump -p 2556 --dump-dir ./
```
Then we can look for the string matching flag using grep in the .dmp file. 

## Flag: crew{1_l0v3_M3m0ry_F0r3ns1cs_S0_muchhhhhhhhh}

<hr><hr><hr>

# Attack 4
Q4. What is the name and PID of the suspicious process ?

example : crew{abcd.exe_111}

<hr>
So here's the pstree.

```
Name                                                  Pid   PPid   Thds   Hnds Time
-------------------------------------------------- ------ ------ ------ ------ ----
 0x860a8c78:csrss.exe                                 352    344      9    462 2023-02-20 19:01:20 UTC+0000
 0x855dfd20:wininit.exe                               404    344      3     76 2023-02-20 19:01:20 UTC+0000
. 0x85ea2368:services.exe                             480    404      8    220 2023-02-20 19:01:20 UTC+0000
.. 0x86071818:svchost.exe                            1280    480     19    312 2023-02-20 19:01:22 UTC+0000
.. 0x8629e188:SearchIndexer.                         2276    480     12    581 2023-02-20 19:01:31 UTC+0000
.. 0x8630b228:wmpnetwk.exe                           2404    480      9    212 2023-02-20 19:01:32 UTC+0000
.. 0x85fae030:svchost.exe                             908    480     18    715 2023-02-20 19:01:21 UTC+0000
.. 0x86251bf0:dllhost.exe                             400    480     15    196 2023-02-20 19:01:26 UTC+0000
.. 0x860ba030:taskhost.exe                           1428    480      9    205 2023-02-20 19:01:22 UTC+0000
.. 0x860b73c8:svchost.exe                            1420    480     10    146 2023-02-20 19:01:22 UTC+0000
.. 0x919e2958:svchost.exe                             752    480     22    507 2023-02-20 19:01:21 UTC+0000
... 0x84df2458:audiodg.exe                           1556    752      6    129 2023-02-20 19:10:50 UTC+0000
.. 0x85f89640:svchost.exe                            2476    480     13    369 2023-02-20 19:03:25 UTC+0000
.. 0x843068f8:sppsvc.exe                             2248    480      4    146 2023-02-20 19:03:25 UTC+0000
.. 0x85fb7670:svchost.exe                             952    480     34    995 2023-02-20 19:01:22 UTC+0000
.. 0x85ef0a90:svchost.exe                             700    480      8    280 2023-02-20 19:01:21 UTC+0000
.. 0x8629e518:msdtc.exe                              2168    480     14    158 2023-02-20 19:01:31 UTC+0000
.. 0x861fc700:svchost.exe                             580    480      6     91 2023-02-20 19:01:25 UTC+0000
.. 0x85ff1380:svchost.exe                            1104    480     18    391 2023-02-20 19:01:22 UTC+0000
.. 0x8619dd20:vm3dservice.ex                         1848    480      4     60 2023-02-20 19:01:24 UTC+0000
... 0x861b5360:vm3dservice.ex                        1908   1848      2     44 2023-02-20 19:01:24 UTC+0000
.. 0x8603a030:spoolsv.exe                            1236    480     13    270 2023-02-20 19:01:22 UTC+0000
.. 0x841d7500:VGAuthService.                         1636    480      3     84 2023-02-20 19:01:23 UTC+0000
.. 0x861a9030:vmtoolsd.exe                           1884    480     13    290 2023-02-20 19:01:24 UTC+0000
.. 0x862cca38:svchost.exe                            2576    480     15    232 2023-02-20 19:01:33 UTC+0000
.. 0x85f9c3a8:svchost.exe                             868    480     13    309 2023-02-20 19:01:21 UTC+0000
... 0x861321c8:dwm.exe                               1576    868      5    114 2023-02-20 19:01:23 UTC+0000
.. 0x85f4d030:svchost.exe                             632    480     10    357 2023-02-20 19:01:21 UTC+0000
... 0x85351030:WmiPrvSE.exe                          3020    632     11    242 2023-02-20 19:01:45 UTC+0000
... 0x86261030:WmiPrvSE.exe                          1748    632     10    204 2023-02-20 19:01:25 UTC+0000
. 0x85ea8610:lsass.exe                                488    404      6    568 2023-02-20 19:01:20 UTC+0000
. 0x85eab718:lsm.exe                                  496    404     10    151 2023-02-20 19:01:20 UTC+0000
 0x843658d0:cmd.exe                                  2112   2876      1     20 2023-02-20 19:03:40 UTC+0000
 0x84368798:cmd.exe                                  2928   2876      1     20 2023-02-20 19:03:40 UTC+0000
 0x84398998:runddl32.exe                              300   2876     10   2314 2023-02-20 19:03:40 UTC+0000
. 0x84390030:notepad.exe                             2556    300      2     58 2023-02-20 19:03:41 UTC+0000
 0x8550b030:csrss.exe                                 416    396      9    268 2023-02-20 19:01:20 UTC+0000
. 0x84365c90:conhost.exe                             1952    416      2     49 2023-02-20 19:03:40 UTC+0000
. 0x84f3d878:conhost.exe                             3664    416      2     51 2023-02-20 19:10:52 UTC+0000
. 0x84384d20:conhost.exe                             2924    416      2     49 2023-02-20 19:03:40 UTC+0000
 0x85eacb80:winlogon.exe                              508    396      5    115 2023-02-20 19:01:20 UTC+0000
 0x8419c020:System                                      4      0     89    536 2023-02-20 19:01:19 UTC+0000
. 0x962f2020:smss.exe                                 268      4      2     29 2023-02-20 19:01:19 UTC+0000
 0x8613c030:explorer.exe                             1596   1540     29    842 2023-02-20 19:01:23 UTC+0000
. 0x84f1caf8:DumpIt.exe                              2724   1596      2     38 2023-02-20 19:10:52 UTC+0000
. 0x853faac8:ProcessHacker.                          3236   1596      9    416 2023-02-20 19:02:37 UTC+0000
. 0x86189d20:vmtoolsd.exe                            1736   1596      8    179 2023-02-20 19:01:23 UTC+0000
```
Honestly, process Hacker felt weird to me at first.. but it apparently is a tool to monitor and detect malware. The commonly used svchost.eve with all its multiple copies looked alright.. .. Dumpit is also a tool. rundll has been misplaced to runddl..

## Flag: crew{runddl32.exe_300}
<hr><hr><hr>

# Attack 5
Q5. What is the another process that is related to this process and it's strange ?

example : crew{spotify.exe}
<hr>

From above pstree we can see that runddl32.exe is parent process of notepad.exe.

## crew{notepad.exe}
<hr><hr><hr>
